<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>å®ˆæœ›å…ˆé”‹è‹±é›„åŒ¹é…é—®å·ï¼ˆå…¨æ®µä½ï¼‰</title>
    <meta name="description" content="å®šä½+è‹±é›„æ± +ä¸»ç»ƒå‰¯ç»ƒå»ºè®®ï¼Œ2-3åˆ†é’Ÿæµ‹å‡ºæ›´é€‚åˆä½ çš„å®ˆæœ›å…ˆé”‹ç©æ³•ã€‚" />
    <style>
      :root {
        --bg: #090f1d;
        --card: #101a36;
        --card-2: #142349;
        --text: #e9eeff;
        --muted: #a6b8ff;
        --line: rgba(255,255,255,.14);
        --accent: #ff9e4a;
        --accent-2: #6ea8fe;
        --ok: #7ce38b;
        --tank: #ffb347;
        --dps: #ff7a9f;
        --support: #7ce38b;
      }
      * { box-sizing: border-box; }
      html, body { overscroll-behavior-y: contain; }
      body {
        margin: 0;
        color: var(--text);
        font-family: Inter, -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif;
        background:
          radial-gradient(1200px 560px at 18% -20%, #1d2f6e 0%, transparent 55%),
          radial-gradient(900px 480px at 100% -10%, #5b2c72 0%, transparent 48%),
          var(--bg);
      }
      .wrap {
        max-width: 1024px;
        margin: 0 auto;
        padding: 18px 14px calc(100px + env(safe-area-inset-bottom, 0px));
      }
      .card {
        background: linear-gradient(180deg, var(--card-2) 0%, var(--card) 100%);
        border: 1px solid var(--line);
        border-radius: 16px;
        box-shadow: 0 14px 38px rgba(0,0,0,.28);
        padding: 16px;
      }
      .brand {
        display:flex; align-items:center; gap:10px; margin-bottom:8px;
      }
      .brand .logo {
        width: 36px; height:36px; border-radius: 10px;
        background: linear-gradient(135deg, var(--accent), var(--accent-2));
        display:grid; place-items:center; color:#09122d; font-weight:900;
      }
      h1 { margin: 0 0 6px; font-size: 28px; letter-spacing:.2px; }
      .sub { color: var(--muted); margin: 0 0 12px; }

      .progress-wrap {
        position: sticky; top: 8px; z-index: 5;
        margin: 8px 0 14px; padding: 10px;
        border: 1px solid var(--line); border-radius: 10px;
        background: rgba(9,15,29,.9); backdrop-filter: blur(6px);
      }
      .progress-head { display:flex; justify-content:space-between; gap:8px; font-size:13px; color:var(--muted); }
      .progress { margin-top:8px; height:8px; border-radius:999px; background:rgba(255,255,255,.08); overflow:hidden; }
      .progress > i { display:block; height:100%; width:0%; background: linear-gradient(90deg,var(--accent),var(--accent-2),var(--ok)); transition: width .25s ease; }
      .legend { margin-top: 6px; color: var(--muted); font-size: 12px; }

      .q {
        margin: 12px 0;
        border: 1px solid var(--line);
        border-radius: 11px;
        padding: 12px;
        background: rgba(255,255,255,.02);
      }
      .q p { margin: 0 0 10px; line-height: 1.5; }
      .q.unanswered { border-color: rgba(255,160,160,.55); box-shadow: 0 0 0 1px rgba(255,160,160,.2) inset; }

      .scale { display:grid; grid-template-columns:repeat(5,minmax(0,1fr)); gap:7px; }
      .opt {
        min-height: 44px;
        display:flex; align-items:center; justify-content:center; gap:6px;
        border:1px solid var(--line); border-radius:10px;
        padding: 7px;
        cursor:pointer;
        user-select:none;
        font-size: 14px;
      }
      .opt input { accent-color: var(--accent-2); transform: scale(1.12); }
      .opt:has(input:checked) {
        border-color: rgba(110,168,254,.95);
        background: rgba(110,168,254,.18);
      }

      .btns { display:flex; gap:10px; flex-wrap:wrap; margin-top: 12px; }
      button {
        border:0; border-radius:10px; min-height:44px; padding:10px 14px;
        font-weight: 800; cursor:pointer;
      }
      .primary { background: linear-gradient(135deg,var(--accent),#ff7e3d); color:#1b0f00; }
      .ghost { background: rgba(255,255,255,.1); color:var(--text); }
      .ghost:disabled, .primary:disabled { opacity:.55; cursor:not-allowed; }

      .result {
        display:none;
        margin-top: 14px;
        border:1px solid var(--line); border-radius: 12px;
        padding: 14px;
        background: rgba(255,255,255,.02);
      }
      .tag { display:inline-block; padding:4px 10px; border-radius:999px; color:var(--ok); background:rgba(124,227,139,.18); font-weight:700; }
      .grid { display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px; margin:10px 0 12px; }
      .metric { border:1px solid var(--line); border-radius:10px; padding:10px; background:rgba(255,255,255,.02); }
      .bar { margin-top:7px; height:8px; border-radius:999px; background:rgba(255,255,255,.08); overflow:hidden; }
      .bar > i { display:block; height:100%; background:linear-gradient(90deg,var(--accent),var(--accent-2),var(--ok)); }

      .radar-card { border:1px solid var(--line); border-radius:12px; padding:10px; background:rgba(255,255,255,.02); margin: 8px 0 12px; }
      #radarCanvas { width:100%; max-width:460px; aspect-ratio:1/1; display:block; margin:0 auto; }

      .hero-grid {
        display:grid;
        grid-template-columns: repeat(5, minmax(0,1fr));
        gap: 10px;
        margin-top: 8px;
      }
      .hero {
        border:1px solid var(--line);
        border-radius:12px;
        background: rgba(255,255,255,.02);
        overflow:hidden;
      }
      .hero img { width:100%; display:block; aspect-ratio:1/1; object-fit:cover; }
      .hero .n { font-size:12px; padding:6px; text-align:center; color:#dce6ff; }

      .small { color:var(--muted); font-size:13px; }
      .footer { margin-top:16px; color:var(--muted); font-size:12px; }

      .mobile-actions { display:none; }
      @media (max-width: 760px) {
        h1 { font-size: 24px; }
        .grid { grid-template-columns: 1fr; }
        .hero-grid { grid-template-columns: repeat(3,minmax(0,1fr)); }
      }
      @media (max-width: 640px) {
        .btns { display:none; }
        .mobile-actions {
          display:grid;
          position:fixed; left:0; right:0; bottom:0; z-index:20;
          grid-template-columns: 1fr 1fr 1fr;
          gap:8px;
          padding:10px 12px calc(10px + env(safe-area-inset-bottom, 0px));
          border-top:1px solid var(--line);
          background:rgba(9,15,29,.95); backdrop-filter:blur(8px);
        }
        .hero-grid { grid-template-columns: repeat(2,minmax(0,1fr)); }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="card">
        <div class="brand">
          <div class="logo">OW</div>
          <div>
            <h1>å®ˆæœ›å…ˆé”‹è‹±é›„åŒ¹é…é—®å·</h1>
          </div>
        </div>
        <p class="sub">å…¨æ®µä½å¯ç”¨ï½œ2-3 åˆ†é’Ÿï½œå®šä½ + è‹±é›„æ±  + ä¸»ç»ƒ/å‰¯ç»ƒ + åˆ†äº«æµ·æŠ¥ï¼ˆå°çº¢ä¹¦3:4ï¼‰</p>

        <div class="progress-wrap">
          <div class="progress-head">
            <span id="progressText">å·²å®Œæˆ 0 / 12</span>
            <span id="progressPercent">0%</span>
          </div>
          <div class="progress"><i id="progressBar"></i></div>
          <div class="legend">1=å®Œå…¨ä¸ç¬¦åˆï¼Œ5=éå¸¸ç¬¦åˆ</div>
        </div>

        <form id="quiz"></form>

        <div class="btns">
          <button class="primary" type="button" id="calcBtn">ç”Ÿæˆæˆ‘çš„ç»“æœ</button>
          <button class="ghost" type="button" id="copyBtn" disabled>å¤åˆ¶ç»“æœæ–‡æ¡ˆ</button>
          <button class="ghost" type="button" id="posterBtn" disabled>ä¸‹è½½åˆ†äº«å›¾ï¼ˆPNGï¼‰</button>
          <button class="ghost" type="button" id="shareBtn" disabled>ç³»ç»Ÿåˆ†äº«</button>
          <button class="ghost" type="button" id="resetBtn">é‡ç½®</button>
        </div>

        <div class="result" id="resultBox">
          <span class="tag" id="typeTag"></span>
          <h2 id="resultTitle"></h2>
          <p id="resultDesc"></p>
          <div class="grid" id="metrics"></div>

          <div class="radar-card">
            <h3 style="margin:2px 0 8px;">é£æ ¼é›·è¾¾å›¾</h3>
            <canvas id="radarCanvas" width="460" height="460"></canvas>
          </div>

          <h3>æ¨èè‹±é›„æ± ï¼ˆä¸»ç»ƒï¼‰</h3>
          <div class="hero-grid" id="heroMain"></div>

          <h3>æ¨èè‹±é›„æ± ï¼ˆå‰¯ç»ƒï¼‰</h3>
          <div class="hero-grid" id="heroSub"></div>

          <h3>ä¸»ç»ƒ / å‰¯ç»ƒè·¯çº¿</h3>
          <p id="route"></p>

          <h3>è®­ç»ƒå»ºè®®ï¼ˆæ“ä½œ / æ„è¯† / é…åˆï¼‰</h3>
          <ul id="tips"></ul>

          <p class="small" id="shareText"></p>
        </div>

        <p class="footer">è¯´æ˜ï¼šæ¯é¢˜ 1-5 åˆ†ã€‚æœ¬é—®å·ç”¨äºè®­ç»ƒæ–¹å‘å»ºè®®ï¼Œä¸ä»£è¡¨ç»å¯¹å¼ºåº¦ã€‚è‹±é›„å›¾ä¸ºå¯çˆ±å ä½ç´ æï¼Œå¯åç»­æ›¿æ¢æˆä½ çš„æ­£å¼ç´ æåŒ…ã€‚</p>
      </div>
    </div>

    <div class="mobile-actions">
      <button class="primary" type="button" id="calcBtnMobile">ç”Ÿæˆç»“æœ</button>
      <button class="ghost" type="button" id="posterBtnMobile" disabled>æµ·æŠ¥</button>
      <button class="ghost" type="button" id="copyBtnMobile" disabled>å¤åˆ¶</button>
    </div>

    <script>
      const questions = [
        'æˆ‘å–œæ¬¢é«˜æœºåŠ¨ã€é¢‘ç¹æ‹‰æ‰¯ã€æ‰“â€œæé™æ“ä½œâ€ã€‚',
        'å›¢æˆ˜é‡Œæˆ‘èƒ½åŒæ—¶å…¼é¡¾å¤šä¸ªä¿¡æ¯ï¼ˆæ•Œæ–¹ä½ç½®/CD/é˜Ÿå‹çŠ¶æ€ï¼‰ã€‚',
        'æˆ‘æ›´å–œæ¬¢â€œå¼€å›¢å†²é”‹â€ï¼Œè€Œä¸æ˜¯â€œåæ’æ…¢ç£¨â€ã€‚',
        'æˆ‘èƒ½æ¥å—é«˜é£é™©é«˜å›æŠ¥ï¼Œå³ä½¿å¶å°”ä¼šå¤±è¯¯ã€‚',
        'æˆ‘æ›´äº«å—â€œå¸®åŠ©é˜Ÿå‹èµ¢â€ï¼Œä¸åªçœ‹ä¸ªäººå‡»æ€ã€‚',
        'æˆ‘å–œæ¬¢é ç«™ä½ã€æ—¶æœºã€æŠ€èƒ½é…åˆèµ¢å›¢ã€‚',
        'æˆ‘çš„å‡†æ˜Ÿè¿½è¸ª/çˆ†å¤´å‘½ä¸­æ¯”è¾ƒç¨³å®šã€‚',
        'æˆ‘å¯¹å…³é”®æŠ€èƒ½æ—¶æœºæŠŠæ¡ä¸é”™ï¼ˆä¿å‘½/åæ‰“/å¼€å›¢ï¼‰ã€‚',
        'æˆ‘èƒ½å¿«é€Ÿåˆ¤æ–­â€œè¯¥è¿›æ”»è¿˜æ˜¯è¯¥æ’¤é€€â€ã€‚',
        'æˆ‘æ„¿æ„ä¸»åŠ¨æŠ¥ç‚¹ã€æ²Ÿé€šã€æ‰“é…åˆã€‚',
        'é‡åˆ°é€†é£å±€ï¼Œæˆ‘æ›´å€¾å‘äºç¨³ä½èŠ‚å¥è€Œä¸æ˜¯ç¡¬æ‹¼ã€‚',
        'æˆ‘æ„¿æ„ä¸ºäº†å›¢é˜Ÿé˜µå®¹è¡¥ä½ï¼Œå³ä½¿ä¸æ˜¯è‡ªå·±æœ€æƒ³ç©çš„è‹±é›„ã€‚'
      ];

      const quiz = document.getElementById('quiz');
      questions.forEach((text, idx) => {
        const i = idx + 1;
        const div = document.createElement('div');
        div.className = 'q';
        div.innerHTML = `<p><b>${i}.</b> ${text}</p><div class="scale">${[1,2,3,4,5].map(v=>`<label class="opt"><input type="radio" name="q${i}" value="${v}">${v}</label>`).join('')}</div>`;
        quiz.appendChild(div);
      });

      const roleIcon = { tank: 'ğŸ›¡ï¸', dps: 'âš”ï¸', support: 'âœ¨' };
      const val = n => Number((document.querySelector(`input[name=q${n}]:checked`) || {}).value || 0);
      const allAnswered = () => Array.from({length: 12}, (_,k)=>val(k+1)).every(Boolean);
      const p = (s,m) => Math.round((s/m)*100);

      function updateProgress(){
        const done = Array.from({length:12}, (_,k)=>val(k+1)).filter(Boolean).length;
        const percent = Math.round(done / 12 * 100);
        document.getElementById('progressText').textContent = `å·²å®Œæˆ ${done} / 12`;
        document.getElementById('progressPercent').textContent = `${percent}%`;
        document.getElementById('progressBar').style.width = `${percent}%`;
      }

      function markUnanswered(){
        document.querySelectorAll('.q').forEach((q, i) => q.classList.toggle('unanswered', !val(i+1)));
      }

      function focusFirstUnanswered(){
        const first = Array.from(document.querySelectorAll('.q')).find((_,i)=>!val(i+1));
        if (first) first.scrollIntoView({behavior:'smooth', block:'center'});
      }

      function scores(){
        return {
          DPS: val(1)+val(4)+val(7),
          Tank: val(3)+val(9)+val(10),
          Support: val(5)+val(6)+val(8),
          Flanker: val(1)+val(2)+val(4),
          Stable: val(11)+val(12)
        };
      }

      const map = {
        DPS: {
          tag: 'è¾“å‡ºæ ¸å¿ƒ', title: 'ä½ æ›´é€‚åˆä¸»ç©è¾“å‡ºä½ï¼ˆDPSï¼‰', desc: 'ä½ åå‘â€œå…‘ç°ä¼¤å®³ã€æ‹¿å…³é”®å‡»æ€â€çš„æ‰“æ³•ã€‚',
          mainAgg: ['genji','tracer','sojourn'], subAgg: ['cassidy','ashe'],
          mainBal: ['soldier-76','cassidy','ashe'], subBal: ['genji','echo'],
          routeAgg: 'ä¸»ç»ƒé«˜æœºåŠ¨åˆ‡å…¥ï¼Œå‰¯ç»ƒä¸­è·ç¨³å®šæªçº¿ã€‚', routeBal: 'ä¸»ç»ƒç¨³å®šä¸­è·å‹åˆ¶ï¼Œå‰¯ç»ƒæœºåŠ¨è¡¥åˆ€ã€‚',
          tipsAgg: ['å…ˆéª—æŠ€èƒ½å†è¿›åœºï¼Œé¿å…è£¸åˆ‡åæ’ã€‚','å‡»æ€å¤±è´¥ç«‹åˆ»æ’¤ç¦»ï¼Œä¿æŒå¾ªç¯éªšæ‰°ã€‚','ä¸å¦å…‹è¿›åœºåŒæ­¥ï¼Œä¸å•é£ã€‚'],
          tipsBal: ['å…ˆæ‰“èƒ½æ‰“åˆ°çš„ç›®æ ‡ï¼Œå‡å°‘ç©ºè½¬ã€‚','ä¼˜å…ˆå é«˜åœ°ï¼Œä¿è¯æŒç»­è¾“å‡ºè§’åº¦ã€‚','æŠ¥æ•Œæ–¹å…³é”®æŠ€èƒ½CDï¼Œå¸®é˜Ÿå‹å†³å®šå¼€å›¢ã€‚']
        },
        Tank: {
          tag: 'å‰çº¿å‘åŠ¨æœº', title: 'ä½ æ›´é€‚åˆä¸»ç©å¦å…‹ä½ï¼ˆTankï¼‰', desc: 'ä½ æ›´æ“…é•¿å¼€å›¢ã€åƒæŠ€èƒ½ã€å¸¦èŠ‚å¥ã€‚',
          mainAgg: ['winston','dva','doomfist'], subAgg: ['reinhardt','ramattra'],
          mainBal: ['reinhardt','sigma','ramattra'], subBal: ['winston','orisa'],
          routeAgg: 'ä¸»ç»ƒæœºåŠ¨å¼€å›¢å¦å…‹ï¼Œå‰¯ç»ƒæ­£é¢ç›¾å‹å¦å…‹ã€‚', routeBal: 'ä¸»ç»ƒç¨³å¥æ§åœºå¦å…‹ï¼Œå‰¯ç»ƒæœºåŠ¨æŠ“æœºä¼šã€‚',
          tipsAgg: ['å¼€å›¢å‰ç¡®è®¤é˜Ÿå‹è§†è§’å’Œèµ„æºã€‚','åƒå®Œç¬¬ä¸€æ³¢ä¼¤å®³ååŠæ—¶è½®è½¬æ©ä½“ã€‚','åˆ‡åæ’è¦æ˜ç¡®ç›®æ ‡ï¼Œä¸æ‹æˆ˜ã€‚'],
          tipsBal: ['å…ˆæ§å…³é”®åœ°å½¢ï¼Œå†è€ƒè™‘æ¨è¿›ã€‚','æŠ€èƒ½åˆ†å±‚äº¤ï¼Œåˆ«ä¸€æ¬¡æ‰“å…‰ã€‚','ä¸»åŠ¨æŠ¥â€œæˆ‘è¦è¿›/æˆ‘æ’¤â€è®©é˜Ÿä¼åŒé¢‘ã€‚']
        },
        Support: {
          tag: 'å›¢é˜Ÿä¸­æ¢', title: 'ä½ æ›´é€‚åˆä¸»ç©è¾…åŠ©ä½ï¼ˆSupportï¼‰', desc: 'ä½ æœ‰æ˜æ˜¾çš„å›¢é˜Ÿå€¾å‘ï¼Œæ“…é•¿ä¿äººå’Œåæ‰“ã€‚',
          mainAgg: ['kiriko','lucio','moira'], subAgg: ['ana','baptiste'],
          mainBal: ['ana','baptiste','illari'], subBal: ['kiriko','mercy'],
          routeAgg: 'ä¸»ç»ƒæœºåŠ¨è¾…åŠ©å¸¦èŠ‚å¥ï¼Œå‰¯ç»ƒå¼ºæ§æ²»ç–—ä½ã€‚', routeBal: 'ä¸»ç»ƒç¨³å®šä¿æ’ï¼Œå‰¯ç»ƒæœºåŠ¨è¡¥ä½ã€‚',
          tipsAgg: ['åˆ«åªé¡¾è¾“å‡ºï¼Œå…ˆä¿æ ¸å¿ƒé˜Ÿå‹ã€‚','è¿›æ”»æŠ€èƒ½ç•™ä¸€æ‰‹åº”å¯¹åæ‰‘ã€‚','ç”¨ä½ç§»å»æŠ¢å…³é”®è§’åº¦ï¼Œä¸ç¡¬ç«™æ­£é¢ã€‚'],
          tipsBal: ['æ²»ç–—ä¼˜å…ˆçº§ï¼šæ ¸å¿ƒè¾“å‡º > å‰å‹å¦å…‹ > å…¶ä½™ã€‚','å…³é”®æŠ€èƒ½ï¼ˆç¡/ç¯/å‡€åŒ–ï¼‰ç•™ç»™æ•Œæ–¹å¤§æ‹›çª—å£ã€‚','å¤šæŠ¥â€œèƒ½æ•‘/ä¸èƒ½æ•‘â€ï¼Œå‡å°‘é˜Ÿå‹è¯¯åˆ¤ã€‚']
        }
      };

      const heroNameBySlug = {
        'ana':'Ana','ashe':'Ashe','baptiste':'Baptiste','bastion':'Bastion','brigitte':'Brigitte','cassidy':'Cassidy','doomfist':'Doomfist','dva':'D.Va','echo':'Echo','freja':'Freja','genji':'Genji','hanzo':'Hanzo','hazard':'Hazard','illari':'Illari','junker-queen':'Junker Queen','junkrat':'Junkrat','juno':'Juno','kiriko':'Kiriko','lifeweaver':'Lifeweaver','lucio':'LÃºcio','mauga':'Mauga','mei':'Mei','mercy':'Mercy','moira':'Moira','orisa':'Orisa','pharah':'Pharah','ramattra':'Ramattra','reaper':'Reaper','reinhardt':'Reinhardt','roadhog':'Roadhog','sigma':'Sigma','sojourn':'Sojourn','soldier-76':'Soldier: 76','sombra':'Sombra','symmetra':'Symmetra','torbjorn':'TorbjÃ¶rn','tracer':'Tracer','vendetta':'Vendetta','venture':'Venture','widowmaker':'Widowmaker','winston':'Winston','wrecking-ball':'Wrecking Ball','wuyang':'Wuyang','zarya':'Zarya','zenyatta':'Zenyatta'
      };

      function getProfile(s){
        const core = [['DPS',s.DPS],['Tank',s.Tank],['Support',s.Support]].sort((a,b)=>b[1]-a[1]);
        const [main] = core[0];
        const [second] = core[1];
        const aggressive = s.Flanker >= 12 && s.Stable <= 6;
        const balanced = s.Flanker >= 10 && s.Stable >= 7;
        const cfg = map[main];
        const mainHeroes = aggressive ? cfg.mainAgg : cfg.mainBal;
        const subHeroes = aggressive ? cfg.subAgg : cfg.subBal;
        const route = aggressive ? cfg.routeAgg : cfg.routeBal;
        const tips = aggressive ? cfg.tipsAgg : cfg.tipsBal;
        const sideMsg = `å‰¯å®šä½å€¾å‘ï¼š${second}ã€‚` + (balanced ? ' ä½ å±äºâ€œèƒ½æ‰“èƒ½ç¨³â€çš„å¹³è¡¡å‹ã€‚' : '');
        return { main, second, cfg, mainHeroes, subHeroes, route, tips, sideMsg };
      }

      function metricCard(name, score, max){
        const cn = { DPS:'è¾“å‡ºä½', Tank:'å¦å…‹ä½', Support:'è¾…åŠ©ä½', Flanker:'æœºåŠ¨åˆºå®¢', Stable:'ç¨³å¥è¡¥ä½' };
        return `<div class="metric"><b>${cn[name]}ï¼š${score}/${max}</b><div class="bar"><i style="width:${p(score,max)}%"></i></div></div>`;
      }

      function renderHeroGrid(elId, slugs){
        const el = document.getElementById(elId);
        el.innerHTML = slugs.map(slug => {
          const name = heroNameBySlug[slug] || slug;
          return `<div class="hero"><img loading="lazy" src="assets/heroes/${slug}.svg" alt="${name}"><div class="n">${name}</div></div>`;
        }).join('');
      }

      function drawRadar(s){
        const c = document.getElementById('radarCanvas');
        const ctx = c.getContext('2d');
        const dpr = Math.max(1, window.devicePixelRatio || 1);
        const css = c.getBoundingClientRect().width || 460;
        c.width = css * dpr; c.height = css * dpr;
        ctx.scale(dpr, dpr);
        const w = css, h = css;
        const cx = w/2, cy = h/2, r = w*0.34;
        ctx.clearRect(0,0,w,h);

        const labels = ['è¾“å‡º','å¦å…‹','è¾…åŠ©','æœºåŠ¨','ç¨³å¥'];
        const vals = [s.DPS/15, s.Tank/15, s.Support/15, s.Flanker/15, s.Stable/10];
        const n = labels.length;

        ctx.strokeStyle = 'rgba(255,255,255,.15)';
        ctx.fillStyle = 'rgba(255,255,255,.06)';
        for(let layer=1; layer<=4; layer++){
          const rr = r * (layer/4);
          ctx.beginPath();
          for(let i=0;i<n;i++){
            const a = -Math.PI/2 + i*2*Math.PI/n;
            const x = cx + Math.cos(a)*rr;
            const y = cy + Math.sin(a)*rr;
            i===0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
          }
          ctx.closePath();
          ctx.stroke();
        }

        for(let i=0;i<n;i++){
          const a = -Math.PI/2 + i*2*Math.PI/n;
          const x = cx + Math.cos(a)*r;
          const y = cy + Math.sin(a)*r;
          ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(x,y); ctx.stroke();
          const tx = cx + Math.cos(a)*(r+20);
          const ty = cy + Math.sin(a)*(r+20);
          ctx.fillStyle = '#cdd9ff';
          ctx.font = '13px Inter, sans-serif';
          ctx.textAlign = 'center';
          ctx.fillText(labels[i], tx, ty);
        }

        ctx.beginPath();
        for(let i=0;i<n;i++){
          const a = -Math.PI/2 + i*2*Math.PI/n;
          const rr = r * vals[i];
          const x = cx + Math.cos(a)*rr;
          const y = cy + Math.sin(a)*rr;
          i===0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
        }
        ctx.closePath();
        ctx.fillStyle = 'rgba(255,158,74,.28)';
        ctx.strokeStyle = 'rgba(110,168,254,.95)';
        ctx.lineWidth = 2;
        ctx.fill(); ctx.stroke();

        for(let i=0;i<n;i++){
          const a = -Math.PI/2 + i*2*Math.PI/n;
          const rr = r * vals[i];
          const x = cx + Math.cos(a)*rr;
          const y = cy + Math.sin(a)*rr;
          ctx.beginPath(); ctx.arc(x,y,4,0,Math.PI*2); ctx.fillStyle = '#7ce38b'; ctx.fill();
        }
      }

      let latestShare = '';
      let latestResult = null;

      function renderResult(){
        if(!allAnswered()){
          markUnanswered();
          focusFirstUnanswered();
          return alert('è¿˜æœ‰é¢˜ç›®æ²¡é€‰å®Œï¼Œå…ˆå…¨éƒ¨ä½œç­”ã€‚');
        }
        const s = scores();
        const r = getProfile(s);
        latestResult = { s, r };

        document.getElementById('resultBox').style.display = 'block';
        document.getElementById('typeTag').textContent = r.cfg.tag;
        document.getElementById('resultTitle').textContent = r.cfg.title;
        document.getElementById('resultDesc').textContent = `${r.cfg.desc} ${r.sideMsg}`;
        document.getElementById('route').textContent = r.route;
        document.getElementById('tips').innerHTML = r.tips.map(t=>`<li>${t}</li>`).join('');
        document.getElementById('metrics').innerHTML = [
          metricCard('DPS', s.DPS, 15), metricCard('Tank', s.Tank, 15), metricCard('Support', s.Support, 15), metricCard('Flanker', s.Flanker, 15), metricCard('Stable', s.Stable, 10)
        ].join('');
        renderHeroGrid('heroMain', r.mainHeroes);
        renderHeroGrid('heroSub', r.subHeroes);
        drawRadar(s);

        latestShare = `æˆ‘çš„å®ˆæœ›è‹±é›„åŒ¹é…ç»“æœï¼š${r.cfg.tag}ï½œ${r.cfg.title}\nä¸»ç»ƒï¼š${r.mainHeroes.map(x=>heroNameBySlug[x]).join(' / ')}\nå‰¯ç»ƒï¼š${r.subHeroes.map(x=>heroNameBySlug[x]).join(' / ')}\nè·¯çº¿ï¼š${r.route}`;
        document.getElementById('shareText').textContent = latestShare;

        ['copyBtn','copyBtnMobile','posterBtn','posterBtnMobile','shareBtn'].forEach(id => {
          const el = document.getElementById(id);
          if (el) el.disabled = false;
        });

        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
      }

      async function copyResult(){
        if(!latestShare) return;
        try { await navigator.clipboard.writeText(latestShare); alert('ç»“æœæ–‡æ¡ˆå·²å¤åˆ¶'); }
        catch { alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é•¿æŒ‰å¤åˆ¶ã€‚'); }
      }

      function drawPosterCanvas(){
        if(!latestResult) return null;
        const { s, r } = latestResult;
        const c = document.createElement('canvas');
        c.width = 1080; c.height = 1440;
        const ctx = c.getContext('2d');

        const grd = ctx.createLinearGradient(0,0,1080,1440);
        grd.addColorStop(0,'#1a2f73'); grd.addColorStop(0.55,'#121d43'); grd.addColorStop(1,'#0a1022');
        ctx.fillStyle = grd; ctx.fillRect(0,0,1080,1440);

        ctx.fillStyle = 'rgba(255,255,255,.09)';
        ctx.fillRect(60,60,960,1320);
        ctx.fillStyle = '#eef3ff';
        ctx.font = '700 56px Inter, sans-serif';
        ctx.fillText('å®ˆæœ›è‹±é›„åŒ¹é…æŠ¥å‘Š', 90, 145);
        ctx.font = '600 36px Inter, sans-serif';
        ctx.fillStyle = '#7ce38b';
        ctx.fillText(`${r.cfg.tag}  Â·  ${r.cfg.title}`, 90, 205);

        const labels = ['DPS','Tank','Support','Flanker','Stable'];
        const vals = [s.DPS/15, s.Tank/15, s.Support/15, s.Flanker/15, s.Stable/10];
        const cx=340, cy=500, rr=180, n=5;
        ctx.strokeStyle='rgba(255,255,255,.18)'; ctx.lineWidth=2;
        for(let layer=1;layer<=4;layer++){
          const rrr=rr*layer/4; ctx.beginPath();
          for(let i=0;i<n;i++){ const a=-Math.PI/2+i*2*Math.PI/n; const x=cx+Math.cos(a)*rrr, y=cy+Math.sin(a)*rrr; i?ctx.lineTo(x,y):ctx.moveTo(x,y);} ctx.closePath(); ctx.stroke();
        }
        ctx.fillStyle='#cfe0ff'; ctx.font='500 24px Inter, sans-serif';
        for(let i=0;i<n;i++){ const a=-Math.PI/2+i*2*Math.PI/n; const x=cx+Math.cos(a)*(rr+34), y=cy+Math.sin(a)*(rr+34); ctx.textAlign='center'; ctx.fillText(labels[i],x,y); }
        ctx.beginPath();
        for(let i=0;i<n;i++){ const a=-Math.PI/2+i*2*Math.PI/n; const rrr=rr*vals[i]; const x=cx+Math.cos(a)*rrr, y=cy+Math.sin(a)*rrr; i?ctx.lineTo(x,y):ctx.moveTo(x,y);} ctx.closePath();
        ctx.fillStyle='rgba(255,158,74,.30)'; ctx.strokeStyle='#6ea8fe'; ctx.lineWidth=5; ctx.fill(); ctx.stroke();

        ctx.textAlign='left';
        ctx.fillStyle='#eaf0ff'; ctx.font='700 34px Inter, sans-serif'; ctx.fillText('ä¸»ç»ƒè‹±é›„', 620, 360);
        ctx.font='500 30px Inter, sans-serif'; ctx.fillStyle='#d6e2ff';
        ctx.fillText(r.mainHeroes.map(h=>heroNameBySlug[h]).join(' / '), 620, 410);
        ctx.fillStyle='#eaf0ff'; ctx.font='700 34px Inter, sans-serif'; ctx.fillText('å‰¯ç»ƒè‹±é›„', 620, 485);
        ctx.font='500 30px Inter, sans-serif'; ctx.fillStyle='#d6e2ff';
        ctx.fillText(r.subHeroes.map(h=>heroNameBySlug[h]).join(' / '), 620, 535);

        ctx.fillStyle='#eaf0ff'; ctx.font='700 34px Inter, sans-serif'; ctx.fillText('ä¸»ç»ƒ / å‰¯ç»ƒè·¯çº¿', 90, 780);
        ctx.font='500 30px Inter, sans-serif'; ctx.fillStyle='#d6e2ff';
        wrapText(ctx, r.route, 90, 830, 900, 42);

        ctx.fillStyle='#eaf0ff'; ctx.font='700 34px Inter, sans-serif'; ctx.fillText('è®­ç»ƒå»ºè®®', 90, 940);
        ctx.font='500 28px Inter, sans-serif'; ctx.fillStyle='#d6e2ff';
        r.tips.forEach((t, i) => wrapText(ctx, `â€¢ ${t}`, 90, 990 + i*58, 900, 40));

        ctx.fillStyle='rgba(255,255,255,.14)'; ctx.fillRect(90,1240,900,80);
        ctx.fillStyle='#e9eeff'; ctx.font='600 28px Inter, sans-serif';
        ctx.fillText('æ¥æµ‹ä½ çš„å®ˆæœ›æœ¬å‘½è‹±é›„ ğŸ‘‰  kazecreator.github.io/ow-hero-quiz/', 110, 1290);

        return c;
      }

      function wrapText(ctx, text, x, y, maxWidth, lineHeight){
        const chars = Array.from(text);
        let line=''; let yy=y;
        for(const ch of chars){
          const test = line + ch;
          if(ctx.measureText(test).width > maxWidth && line){ ctx.fillText(line,x,yy); line=ch; yy += lineHeight; }
          else line = test;
        }
        if(line) ctx.fillText(line,x,yy);
      }

      function downloadPoster(){
        const c = drawPosterCanvas();
        if(!c) return;
        const a = document.createElement('a');
        a.href = c.toDataURL('image/png');
        a.download = `ow-quiz-${Date.now()}.png`;
        a.click();
      }

      async function nativeSharePoster(){
        const c = drawPosterCanvas();
        if(!c) return;
        const blob = await new Promise(r=>c.toBlob(r, 'image/png'));
        const file = new File([blob], 'ow-quiz-result.png', { type: 'image/png' });
        if(navigator.canShare && navigator.canShare({ files:[file] })) {
          await navigator.share({ files:[file], title:'å®ˆæœ›è‹±é›„åŒ¹é…ç»“æœ', text:'æˆ‘æµ‹äº†æˆ‘çš„å®ˆæœ›æœ¬å‘½è‹±é›„ï¼Œæ¥è¯•è¯•ï¼' });
        } else {
          downloadPoster();
          alert('å½“å‰æµè§ˆå™¨ä¸æ”¯æŒç³»ç»Ÿæ–‡ä»¶åˆ†äº«ï¼Œå·²è‡ªåŠ¨ä¸‹è½½æµ·æŠ¥ã€‚');
        }
      }

      function resetAll(){
        document.querySelectorAll('input[type=radio]').forEach(i => i.checked = false);
        document.getElementById('resultBox').style.display = 'none';
        ['copyBtn','copyBtnMobile','posterBtn','posterBtnMobile','shareBtn'].forEach(id => {
          const el = document.getElementById(id); if (el) el.disabled = true;
        });
        latestShare = '';
        latestResult = null;
        updateProgress(); markUnanswered();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      document.getElementById('calcBtn').addEventListener('click', renderResult);
      document.getElementById('calcBtnMobile').addEventListener('click', renderResult);
      document.getElementById('copyBtn').addEventListener('click', copyResult);
      document.getElementById('copyBtnMobile').addEventListener('click', copyResult);
      document.getElementById('posterBtn').addEventListener('click', downloadPoster);
      document.getElementById('posterBtnMobile').addEventListener('click', downloadPoster);
      document.getElementById('shareBtn').addEventListener('click', nativeSharePoster);
      document.getElementById('resetBtn').addEventListener('click', resetAll);
      quiz.addEventListener('change', () => { updateProgress(); markUnanswered(); });

      updateProgress();
      markUnanswered();
    </script>
  </body>
</html>
